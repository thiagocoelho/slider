// zhenya-slider
// Zhenya Savchenko (http://github.com/zhenyasav)
// git://github.com/zhenyasav/slider.git

(function(){var a=[].slice,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;this.Slider=function(){function c(a,b){var d,e,g,h,i;if(this.options=l.extend({},c.defaults,null!=b?b:{}),"string"==typeof a){if(this.element=document.querySelector(a),!this.element)throw c.errors.selectorEmpty}else{if(!(a instanceof Element))throw c.errors.elementInvalid;this.element=a}null!=(h=c.instances)&&"function"==typeof h.push&&h.push(this),this.events=new f(this),this.onFormElementChange=function(a){return function(b){var d,e,f,g,h;if(h=null!=b&&null!=(e=b.target)?e.value:void 0,null!=h){if(h=Number(h),!isFinite(h)||isNaN(h))return a.warn(c.errors.valueInvalid),null!=b&&null!=(g=b.target)?g.value=a.value():void 0;if(d=a.value(h,{updateFormElement:!1}),null==d)return null!=b&&null!=(f=b.target)?f.value=a.value():void 0}}}(this),this.options.formElement&&this.bindFormElement(this.options.formElement),l.addClass(this.element,"slider"),l.addClass(this.element,this.options.orientation),i=c.components;for(d in i)g=i[d],(e=g(this.options))&&(this[d]=new e(this,this.options[d]));this.value(this.options.initial),this.options.poll&&c.polling.start(),window.addEventListener("resize",l.throttle(function(a){return function(){return a.refresh()}}(this),600))}var d,e,f,g,h,i,j,k,l,m;return l=c._={extend:function(){var b,c,d,e,f,g,h,i,j;if(b=1<=arguments.length?a.call(arguments,0):[],b.length){if(1===b.length)return b[0];for(c=null!=(i=b.splice(0,1))?i[0]:void 0,d=e=0,g=b.length;g>e;d=++e){h=b[d];for(f in h)j=h[f],c[f]=j}return c}},map:function(a,b){var c,d,e,f,g,h;if(l.isArray(a)){for(f=[],d=c=0,e=a.length;e>c;d=++c)h=a[d],f.push("function"==typeof b?b(h,d):void 0);return f}g=[];for(d in a)h=a[d],g.push("function"==typeof b?b(h,d):void 0);return g},find:function(a,b){var c,d,e,f;if(l.isArray(a)){for(d=c=0,e=a.length;e>c;d=++c)if(f=a[d],"function"==typeof b?b(f,d):void 0)return f}else for(d in a)if(f=a[d],"function"==typeof b?b(f,d):void 0)return f},isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},isMobile:"ontouchstart"in window,delay:function(a,b){return setTimeout(b,a)},throttle:function(a,b,c){var d;return d=null,function(){var e,f;return d&&clearTimeout(d),e=function(){var a,b,c;for(c=[],a=0,b=arguments.length;b>a;a++)f=arguments[a],c.push(f);return c}.apply(this,arguments),d=setTimeout(function(){return null!=a&&"function"==typeof a.apply?a.apply(null!=c?c:this,e):void 0},b)}},addClass:function(a,b){var c;return null!=a&&null!=(c=a.classList)?c.add(b):void 0},removeClass:function(a,b){var c;return null!=a&&null!=(c=a.classList)?c.remove(b):void 0},offset:function(a){var b,c;if(a instanceof Element){for(b={x:a.offsetLeft,y:a.offsetTop},c=a.offsetParent;null!=c;)b.x+=c.offsetLeft,b.y+=c.offsetTop,c=c.offsetParent;return b}},transform:function(a,b,c){var d,e;return e=null!=a?a.style:void 0,b instanceof k&&(d=b,b=d.x,c=d.y),e.transform=e.WebkitTransform=e.msTransform="translate3d("+b.toFixed(3)+"px, "+c.toFixed(3)+"px, 0)"},clamp:function(a,b,c){return null!=b&&b>a&&(a=b),null!=c&&a>c&&(a=c),a},roundTo:function(a,b){return b*Math.round(a/b)},sign:function(a){return"number"!=typeof a||isNaN(a)||!isFinite(a)?0:a>=0?1:-1},fixFPError:function(a){var b,c,d;return d=String(a),/\..*00000\d$/i.test(d)?Number(d.substring(0,d.length-1)):/\..*99999\d$/i.test(d)?(c=Number(d[d.length-1]),b=d.indexOf("."),b=b-d.length+1,a+l.sign(a)*(10-c)*Math.pow(10,b)):a},formatObject:function(a,b){return null==b&&(b=0),l.map(a,function(a,c){var d;return"string"==typeof a&&(a='"'+a+'"'),"[object Object]"===Object.prototype.toString.call(a)&&(a="\n"+l.formatObject(a,b+1)),""+(b?function(){var a,c,e;for(e=[],d=a=0,c=b;c>=0?c>=a:a>=c;d=c>=0?++a:--a)e.push("  ");return e}().join(""):"")+c+": "+a}).join("\n")},formatNumber:function(a,b){var c,d,e,f,g;return c={inf:"&#8734;",nan:"?",decimalPlaces:2,separator:""},b=l.extend({},c,null!=b?b:{}),"number"!=typeof a?a:isNaN(a)?"?":isFinite(a)?(f=0!==a?Math.floor(Math.log10(Math.abs(a))):0,g=function(a,c){return function(d){var e;return e=l.sign(d)*Math.round(Math.abs(d)/Math.pow(10,a-b.decimalPlaces))/Math.pow(10,b.decimalPlaces),e+b.separator+c}},d=[g(0,""),g(3,"k"),g(6,"M"),g(9,"G"),g(12,"T"),g(15,"P"),g(18,"E"),g(21,"Z"),g(24,"Y")],e=[g(0,""),g(-3,"m"),g(-6,"Î¼"),g(-9,"n"),g(-12,"p"),g(-15,"f"),g(-18,"a"),g(-21,"z"),g(-24,"y")],f=l.sign(f)*Math.floor(Math.abs(f)/3),f>=0?(f=l.clamp(f,0,d.length-1),""+d[f](a)):(f=l.clamp(f,-e.length+1,0),""+e[-f](a))):"&#8734;"},log:function(a){return console.log(a),a},tag:function(b){return function(){var c,d,e,f,g,h,i,j,k,m,n,o;for(e=1<=arguments.length?a.call(arguments,0):[],f={},k=e[e.length-1],(k instanceof Element||l.isArray(k))&&(g=null!=(n=e.splice(e.length-1,1))?n[0]:void 0),i=0,m=e.length;m>i;i++){d=e[i];for(j in d)o=d[j],f[j]=o}h=document.createElement(b);for(c in f)o=f[c],h.setAttribute(c,o);return l.isArray(g)||(g=[g]),g.map(function(a){return a instanceof Element?h.appendChild(a):void 0}),h}}},l.div=l.tag("div"),l.pre=l.tag("pre"),m=l.isMobile?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"],l.startEvent=m[0],l.moveEvent=m[1],l.endEvent=m[2],k=c.Vector=function(){function a(a,b){var c;a instanceof Event?(l.isMobile&&(c="touchend"===a.type?a.changedTouches:a.touches),this.x=l.isMobile?c[0].pageX:a.pageX,this.y=l.isMobile?c[0].pageY:a.pageY):this.set({x:a,y:b})}return a.prototype.set=function(a){return null!=(null!=a?a.x:void 0)&&(this.x=a.x),null!=(null!=a?a.y:void 0)?this.y=a.y:void 0},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.subtract=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},a.prototype.clamp=function(a){var b,c,d,e;return this.x=l.clamp(this.x,null!=a&&null!=(b=a.x)?b[0]:void 0,null!=a&&null!=(c=a.x)?c[1]:void 0),this.y=l.clamp(this.y,null!=a&&null!=(d=a.y)?d[0]:void 0,null!=a&&null!=(e=a.y)?e[1]:void 0)},a}(),f=c.Dispatcher=function(){function a(a){this.owner=a,this.listeners={}}return a.errors={invalidEventType:"event type must be a non-empty string",invalidListener:"event listener must be a function"},a.prototype.trigger=function(b,c){var d,e,f;if("string"!=typeof b||!b)throw a.errors.invalidEventType;return(null!=(d=this.listeners)&&null!=(e=d[b])?e.length:void 0)?(f=(new Date).getTime(),c=l.extend(null!=c?c:{},{type:b,time:f}),setTimeout(function(a){return function(){var d,e,f,g,h;for(g=a.listeners[b],h=[],d=0,e=g.length;e>d;d++)f=g[d],h.push(null!=f&&"function"==typeof f.call?f.call(a.owner,c):void 0);return h}}(this))):void 0},a.prototype.on=function(b,c){var d;if("string"!=typeof b||!b)throw a.errors.invalidEventType;if("function"!=typeof c)throw a.errors.invalidListener;return null==(d=this.listeners)[b]&&(d[b]=[]),0>this.listeners[b].indexOf(c)?this.listeners[b].push(c):void 0},a.prototype.off=function(a,b){var c;if("function"==typeof a&&(b=a,a=void 0),a){if(!b)return delete this.listeners[a];if(c=this.listeners[a].indexOf(b),c>=0)return this.listeners[a].splice(c,1)}else if(b)return l.map(this.listeners,function(){return function(a){return c=a.indexOf(b),c>=0?a.splice(c,1):void 0}}(this))},a.prototype.once=function(b,c){var d;if("string"!=typeof b||!b)throw a.errors.invalidEventType;if("function"!=typeof c)throw a.errors.invalidListener;return d=function(a){return function(c){var d;return d=function(e){return a.off(b,d),null!=c&&"function"==typeof c.call?c.call(a.owner,e):void 0}}}(this),this.on(b,d(c))},a}(),c.errors={selectorEmpty:"slider element selector must return at least one element",elementInvalid:"first argument must be a selector or an element",valueInvalid:"slider value must be between options.min and options.max",positionInvalid:"slider position must be between 0 and 1"},c.polling={timeout:null,interval:1931,start:function(){return null==this.timeout?this.timeout=setInterval(function(){return c.instances.map(function(a){return!a.options.poll||a.transitioning||a.dragging?void 0:a.position(a.position())})},this.interval):void 0},stop:function(){return null!=this.timeout?clearInterval(this.timeout):void 0}},c.defaults={min:0,max:1,initial:0,step:.1,warnings:!0,orientation:"horizontal",transitionDuration:350,poll:!1,formElement:null},c.instances=[],c.getInstance=function(a){return a instanceof Element?l.find(c.instances,function(b){return b.element===a}):null},c.prototype.warn=function(){var a;return this.options.warnings&&"undefined"!=typeof console&&null!==console&&null!=(a=console.warn)?a.apply(console,arguments):void 0},c.prototype.refresh=function(){var a;return a=function(a){return function(){return a.position(a.position(),{changeEvent:!1,transitionEvent:!1})}}(this),this.transitioning?this.events.once("transition",function(){return function(){return a}}(this)):a()},c.prototype.bindFormElement=function(a,b){var d;if(d={unbindOldElement:!0},b=l.extend({},d,b),"string"==typeof a){if(a=document.querySelector(a),!a)throw c.errors.selectorEmpty}else if(!(a instanceof Element))throw c.errors.elementInvalid;return b.unbindOldElement&&this.formElement&&this.onFormElementChange&&this.formElement.removeEventListener("change",this.onFormElementChange),a.addEventListener("change",this.onFormElementChange),this.formElement=a},c.prototype.value=function(a,b){return null==b&&(b={}),this.position(a,l.extend(b,{normalized:!1}))},c.prototype.position=function(a,b){var d,e,f,g,h,i,j,k,m;if(l.isObject(a)&&(b=a,a=void 0),f={normalized:!0,transition:this.options.transitionDuration,changeEvent:!0,transitionEvent:!0,step:(null!=b?b.normalized:void 0)===!1?this.options.step:this.options.step/(this.options.max-this.options.min),updateFormElement:!0},b=l.extend({},f,b),g=void 0===a?this.normalizedPosition:b.normalized?a:(a-this.options.min)/(this.options.max-this.options.min),k=b.step?b.normalized?b.step:b.step/(this.options.max-this.options.min):1/this.knob.range(),g=l.fixFPError(l.roundTo(g,k)),m=b.normalized?function(a){return a}:function(a){return function(b){return a.options.min+b*(a.options.max-a.options.min)}}(this),void 0===a)return l.fixFPError(m(g));if(!(m(0)<=a&&a<=m(1)))return void this.warn(b.normalized?c.errors.positionInvalid:c.errors.valueInvalid);this.normalizedPosition=g,b.transition&&(l.addClass(this.element,"transition"),this.transitioning=!0),h=c.components;for(d in h)e=h[d],null!=(i=this[d])&&"function"==typeof i.position&&i.position(this.normalizedPosition,b);return b.updateFormElement&&null!=(j=this.formElement)&&(j.value=this.value()),b.changeEvent&&this.events.trigger("change",{value:this.value()}),b.transition&&l.delay(b.transition,function(a){return function(){return l.delay(17,function(){return l.removeClass(a.element,"transition"),a.transitioning=!1,b.transitionEvent?a.events.trigger("transition"):void 0})}}(this)),g},d=c.Component=function(){function a(){}return a}(),j=c.Track=function(a){function c(a,b){var d,e;this.slider=a,this.options=l.extend({},null!=(d=c.defaults)?d:{},null!=b?b:{}),this.slider.element.appendChild(this.element=l.div({"class":"track"})),e=null,this.element.addEventListener(l.startEvent,function(){return function(a){return e=new k(a)}}(this)),this.element.addEventListener(l.endEvent,function(a){return function(b){var c,d,f,g;return null!=e&&(f=new k(b),c=f.subtract(e).magnitude(),e=null,5>c)?(g=l.offset(a.element),d=function(){switch(this.slider.options.orientation){case"horizontal":return f.x-g.x;case"vertical":return f.y-g.y}}.call(a),a.slider.position(l.clamp((d-a.slider.knob.size()/2)/a.slider.knob.range(),0,1))):void 0}}(this))}return b(c,a),c.prototype.size=function(){switch(this.slider.options.orientation){case"horizontal":return this.element.offsetWidth;case"vertical":return this.element.offsetHeight}},c}(d),h=c.Knob=function(a){function c(a,b){var d,e,f;this.slider=a,this.options=l.extend({},null!=(d=c.defaults)?d:{},null!=b?b:{}),this.slider.element.appendChild(this.element=l.div({"class":"knob"})),this.offset=new k(0,0),this.options.interactive&&(e=null,f=null,this.element.addEventListener(l.startEvent,function(a){return function(b){return e=new k(b),f=a.offset.clone(),l.removeClass(a.slider.element,"transition"),l.addClass(a.slider.element,"dragging"),a.slider.dragging=!0}}(this)),window.addEventListener(l.moveEvent,function(a){return function(b){var c,d;return null!=e&&(b.preventDefault(),d=new k(b),c=d.subtract(e),c=c.add(f),a.slider.position(function(){switch(this.slider.options.orientation){case"horizontal":return l.clamp(c.x/this.range(),0,1);case"vertical":return l.clamp(c.y/this.range(),0,1)}}.call(a),{transition:!1,step:!1,changeEvent:!1}),a.options.dragEvents)?a.slider.events.trigger("drag",{position:a.slider.position(),value:a.slider.value()}):void 0}}(this)),window.addEventListener(l.endEvent,function(a){return function(){return null!=e?(e=null,l.removeClass(a.slider.element,"dragging"),a.slider.dragging=!1,null!=a.slider.options.step?a.slider.position(a.slider.position()):(a.slider.events.trigger("change"),a.slider.events.trigger("transition"))):void 0}}(this)))}return b(c,a),c.defaults={interactive:!0,dragEvents:!0},c.prototype.size=function(){switch(this.slider.options.orientation){case"horizontal":return this.element.offsetWidth+2*this.element.offsetLeft;case"vertical":return this.element.offsetHeight+2*this.element.offsetTop}},c.prototype.range=function(){return this.slider.track.size()-this.size()},c.prototype.position=function(a){return this.offset.set(function(){switch(this.slider.options.orientation){case"horizontal":return{x:this.range()*a,y:0};case"vertical":return{x:0,y:this.range()*a}}}.call(this)),l.transform(this.element,this.offset)},c}(d),i=c.Label=function(a){function c(a,b){this.slider=a,c.__super__.constructor.call(this,this.slider,l.extend({},c.defaults,null!=b?b:{},{interactive:!1})),l.addClass(this.element,"label"),this.options.popup&&l.addClass(this.element,"popup"),this.element.appendChild(this.popup=l.div({"class":"popup"},[this.value=l.div({"class":"value"}),l.div({"class":"arrow"})])),this.element.appendChild(this.hiddenValue=l.div({"class":"hidden value"})),"knob"===this.options.location&&this.slider.knob.element.appendChild(this.hiddenKnobValue=l.div({"class":"hidden value"}))}return b(c,a),c.defaults={location:"knob",precision:1,popup:!0,format:function(a,b){return l.formatNumber(a,{decimalPlaces:b.precision})}},c.prototype.position=function(a,b){var d,e;return c.__super__.position.call(this,a,b),e="function"==typeof(d=this.options).format?d.format(this.slider.value(),this.options):void 0,this.value.innerText=this.hiddenValue.innerText=this.hiddenKnobValue.innerText=e},c}(h),g=c.Fill=function(a){function c(a,b){this.slider=a,this.options=null!=b?b:c.defaults,l.addClass(this.slider.element,"fill-"+this.options),this.slider.track.element.appendChild(this.element=l.div({"class":"fill"}))}return b(c,a),c.defaults=null,c.prototype.position=function(a){var b;return"upper"===this.options&&(a=1-a),b="horizontal"===this.slider.options.orientation?"width":"height",this.element.style[b]=a*this.slider.knob.range()+this.slider.knob.size()/2+"px"},c}(d),e=c.Debug=function(a){function c(a){this.slider=a,this.slider.element.appendChild(this.element=l.pre({"class":"debug"}))}return b(c,a),c.prototype.position=function(a){return this.element.innerText=l.formatObject({position:a,value:this.slider.value()})},c}(d),c.components={track:function(){return j},knob:function(){return h},label:function(){return i},fill:function(a){return null!=a.fill?g:void 0},debug:function(a){return a.debug?e:void 0}},c}()}).call(this);